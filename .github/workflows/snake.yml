name: ğŸ Cyberpunk Snake Generator â€” Aditya Singh Edition v3

on:
  schedule:
    - cron: "0 3 * * *"  # ğŸ•’ Runs every day at 3 AM IST
  workflow_dispatch:      # ğŸ® Manual trigger
  push:
    branches:
      - main

jobs:
  build-snake:
    runs-on: ubuntu-latest

    permissions:
      contents: write
      actions: read

    env:
      USERNAME: adityasinnghh
      OUTPUT_DIR: dist

      THEME_DARK: github-dark
      THEME_LIGHT: github-light

    steps:
      - name: ğŸ§© Checkout repository
        uses: actions/checkout@v4

      - name: âš¡ Cache snake build data
        uses: actions/cache@v3
        with:
          path: ~/.cache/snk
          key: ${{ runner.os }}-cyber-snk-cache

      # ====== 1ï¸âƒ£ Generate Base Snakes ======
      - name: ğŸ Generate Base Snakes (Dark + Light)
        uses: Platane/snk@v3
        with:
          github_user_name: ${{ env.USERNAME }}
          outputs: |
            ${{ env.OUTPUT_DIR }}/snake-dark.svg?palette=${{ env.THEME_DARK }}
            ${{ env.OUTPUT_DIR }}/snake-light.svg?palette=${{ env.THEME_LIGHT }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      # ====== 2ï¸âƒ£ Generate Rainbow Base ======
      - name: ğŸŒˆ Generate Rainbow Snake Base
        uses: Platane/snk@v3
        with:
          github_user_name: ${{ env.USERNAME }}
          outputs: |
            ${{ env.OUTPUT_DIR }}/snake-rainbow.svg
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      # ====== 3ï¸âƒ£ Apply Neon Cyberpunk Gradient ======
      - name: ğŸ’« Apply Neon Cyberpunk Colors
        run: |
          sed -i \
          -e 's/#39d353/#ff00ff/g' \
          -e 's/#26a641/#00ffff/g' \
          -e 's/#006d32/#9400ff/g' \
          -e 's/stroke="#40c463"/stroke="url(#neonGradient)"/g' \
          "${{ env.OUTPUT_DIR }}/snake-rainbow.svg"

          # Inject glowing gradient defs at top of file
          sed -i '1i\
          <defs>\
            <linearGradient id="neonGradient" x1="0%" y1="0%" x2="100%" y2="0%">\
              <stop offset="0%" stop-color="#00ffff">\
                <animate attributeName="stop-color" values="#00ffff;#ff00ff;#00ffff" dur="4s" repeatCount="indefinite"/>\
              </stop>\
              <stop offset="100%" stop-color="#ff00ff">\
                <animate attributeName="stop-color" values="#ff00ff;#00ffff;#ff00ff" dur="4s" repeatCount="indefinite"/>\
              </stop>\
            </linearGradient>\
          </defs>' "${{ env.OUTPUT_DIR }}/snake-rainbow.svg"

          echo "âš¡ Cyberpunk neon gradient applied successfully!"

      # ====== 4ï¸âƒ£ Generate Animated GIF ======
      - name: ğŸï¸ Generate Animated GIF Snake
        uses: Platane/snk@v3
        with:
          github_user_name: ${{ env.USERNAME }}
          outputs: |
            ${{ env.OUTPUT_DIR }}/snake.gif
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      # ====== 5ï¸âƒ£ Random Commit Message ======
      - name: âœ¨ Generate random emoji commit message
        id: commitmsg
        run: |
          msgs=("ğŸ’« Cyberpunk glow snake" "ğŸŒˆ Neon pulse slithering" "âš¡ Grid lightning effect" "ğŸ”¥ RGB snake unleashed" "ğŸ§¬ Matrix serpent reborn")
          echo "message=${msgs[$RANDOM % ${#msgs[@]}]}" >> $GITHUB_OUTPUT

      # ====== 6ï¸âƒ£ Push to output branch ======
      - name: ğŸš€ Deploy to output branch
        uses: crazy-max/ghaction-github-pages@v3.1.0
        with:
          target_branch: output
          build_dir: ${{ env.OUTPUT_DIR }}
          commit_message: ${{ steps.commitmsg.outputs.message }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      # ====== 7ï¸âƒ£ Fancy Console Output ======
      - name: ğŸ‰ Final Log Output
        run: |
          echo "========================================"
          echo "ğŸ  CYBERPUNK SNAKE GENERATED SUCCESSFULLY"
          echo "ğŸ‘¤  USER: ${{ env.USERNAME }}"
          echo "ğŸ¨  THEMES: Dark, Light, Rainbow, Cyberpunk Neon"
          echo "ğŸŒˆ  OUTPUT: ${{ env.OUTPUT_DIR }}/"
          echo "ğŸš€  PUSHED TO: output branch"
          echo "ğŸ”—  PREVIEW: https://raw.githubusercontent.com/${{ env.USERNAME }}/${{ env.USERNAME }}/output/snake-rainbow.svg"
          echo "âš¡  Stay luminous, coder!"
          echo "========================================"
